# AWS CodeBuild
version: 0.2

env:
  parameter-store:
    # Toolbox: Retrieve encryption key
    XLZCRYPT_KEY: "xlzcrypt_key"

phases:
  install:
    commands:
      # Toolbox: Initialize
      - sudo $CODEBUILD_SRC_DIR_toolbox/install.py

  build:
    commands:
      # Run remote test
      - xlz run drmlib_dev=$CODEBUILD_SOURCE_VERSION aws_fpga_sdk drmlib_build_deps drmlib_unittests_deps drmlib_cred_json drmlib_codecov_token -n DRM_Library_Test -z /dev/shm/drmlib_dev/.tox/debug/build/report report.tar.gz -r "cd /dev/shm/drmlib_dev && sudo -E tox -- --cred=/dev/shm/cred.json"

artifacts:
  files:
    # Retrieve Reports (Coverage, Cython annotation)
    - report.tar.gz
