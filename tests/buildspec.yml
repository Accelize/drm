# AWS CodeBuild
version: 0.2

env:
  parameter-store:
    # Toolbox: Retrieve encryption key
    XLZCRYPT_KEY: "xlzcrypt_key"

phases:
  install:
    commands:
      # Toolbox: Initialize
      - sudo $CODEBUILD_SRC_DIR_toolbox/install.py

  build:
    commands:
      # Run remote test (C and C++ in parallel on dual FPGA instance)
      - xlz run aws_fpga_sdk drmlib_build_deps drmlib_unittests_deps drmlib_cred_json -n Accelize_DRM_test -z ./.tox/debug/build/report report.tar.gz -r "sudo tox -- --cred=/dev/shm/cred.json"

artifacts:
  files:
    - report.tar.gz
